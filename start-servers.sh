#!/bin/bash

echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð²..."

# ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð²ÑÐµ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹ node
echo "ðŸ›‘ ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹..."
pkill -f node 2>/dev/null || true
sleep 2

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð±ÑÐºÐµÐ½Ð´
echo "ðŸ”§ Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð±ÑÐºÐµÐ½Ð´ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 3012..."
cd backend
node simple-count-server.js &
BACKEND_PID=$!
cd ..

# Ð–Ð´ÐµÐ¼ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±ÑÐºÐµÐ½Ð´Ð°
sleep 3

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð±ÑÐºÐµÐ½Ð´
echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð±ÑÐºÐµÐ½Ð´..."
curl -s http://localhost:3012/api/health > /dev/null
if [ $? -eq 0 ]; then
    echo "âœ… Ð‘ÑÐºÐµÐ½Ð´ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½"
else
    echo "âŒ Ð‘ÑÐºÐµÐ½Ð´ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»ÑÑ"
    exit 1
fi

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´
echo "ðŸŽ¨ Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 3002..."
cd frontend
npm run dev &
FRONTEND_PID=$!
cd ..

echo "ðŸŽ‰ Ð¡ÐµÑ€Ð²ÐµÑ€Ñ‹ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹!"
echo "ðŸ“± Frontend: http://localhost:3002"
echo "ðŸ”§ Backend: http://localhost:3012"
echo ""
echo "Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C"

# Ð–Ð´ÐµÐ¼ ÑÐ¸Ð³Ð½Ð°Ð»Ð° Ð´Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸
trap "echo 'ðŸ›‘ ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ ÑÐµÑ€Ð²ÐµÑ€Ñ‹...'; kill $BACKEND_PID $FRONTEND_PID 2>/dev/null; exit" INT

wait 